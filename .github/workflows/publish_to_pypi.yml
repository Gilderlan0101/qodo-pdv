# Nome do fluxo de trabalho (aparece na aba 'Actions' do GitHub)
name: Publicar no PyPI

# Define quando este fluxo de trabalho ser√° executado
on:
  # Executa sempre que um novo 'release' for criado
  release:
    types: [published]
  # Permite executar manualmente
  workflow_dispatch:

# Permiss√µes necess√°rias para o trabalho de deploy
permissions:
  contents: write # Necess√°rio para fazer checkout do c√≥digo
  id-token: write # Necess√°rio para autentica√ß√£o no PyPI (OIDC) - M√©todo moderno e seguro

jobs:
  # O trabalho principal para construir e fazer o deploy
  deploy:
    runs-on: ubuntu-latest
    environment:
      name: pypi
      url: https://pypi.org/p/qodo 

    steps:
    - name: ‚¨áÔ∏è Checkout do c√≥digo
      uses: actions/checkout@v4

    - name: ‚öôÔ∏è Configurar Python (3.x)
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: üõ†Ô∏è Instalar depend√™ncias de build
      run: |
        # Instala build, setuptools e wheel para criar os pacotes
        python -m pip install --upgrade pip
        pip install build setuptools wheel

    - name: üèóÔ∏è Construir o pacote (sdist e wheel)
      # Isso gera os arquivos .tar.gz e .whl na pasta 'dist/'
      run: python -m build

    # O bloco de steps que usava 'pypi-actions/configure-poetry' e 'pypi-actions/upload-and-release'
    # foi removido e substitu√≠do por uma √∫nica a√ß√£o oficial.
    
    - name: üöÄ Publicar no PyPI (via OIDC)
      # A√ß√£o oficial e recomendada. Ela detecta automaticamente os arquivos em 'dist/'
      uses: pypi/gh-action-pypi-publish@main